<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Retrofit Structured Fields for HTTP</title><script>
function anchorRewrite() {
  map = { };
  if (window.location.hash.length >= 1) {
    var fragid = window.location.hash.substr(1);
    if (fragid) {
      if (! document.getElementById(fragid)) {
        var prefix = "rfc.";
        var mapped = map[fragid];
        if (mapped) {
          window.location.hash = mapped;
        } else if (fragid.indexOf("section-") == 0) {
          window.location.hash = prefix + "section." + fragid.substring(8);
        } else if (fragid.indexOf("appendix-") == 0) {
          window.location.hash = prefix + "section." + fragid.substring(9);
        } else if (fragid.indexOf("s-") == 0) {
          var postfix = fragid.substring(2);
          if (postfix.startsWith("abstract")) {
            window.location.hash = prefix + postfix;
          } else if (postfix.startsWith("note-")) {
            window.location.hash = prefix + "note." + postfix.substring(5);
          } else {
            window.location.hash = prefix + "section." + postfix;
          }
        } else if (fragid.indexOf("p-") == 0) {
          var r = fragid.substring(2);
          var p = r.indexOf("-");
          if (p >= 0) {
            window.location.hash = prefix + "section." + r.substring(0, p) + ".p." + r.substring(p + 1);
          }
        }
      }
    }  
  }
}
window.addEventListener('hashchange', anchorRewrite);
window.addEventListener('DOMContentLoaded', anchorRewrite);
</script><meta name="viewport" content="width=device-width, initial-scale=1"><meta property="og:type" content="article"><meta property="og:title" content="Retrofit Structured Fields for HTTP"><meta property="og:description" content="This specification defines how a selection of existing HTTP fields can be handled as Structured Fields."><meta property="og:url" content="https://mnot.github.io/I-D/http-structure-retrofit/"><meta property="og:site_name" content="mnot's Internet Drafts"><link rel="stylesheet" type="text/css" href="../Tools/style.css"><style type="text/css">
      body {
        padding-top: 80px;
        padding-bottom: 80px;
        position: relative;
      }
      .table.header th, .table.header td {
        border-top: none;
        padding: 0;
      }
      #sidebar {
        margin-top: -10px;
        height: 90%;
        overflow-y: auto;
        font-size: 90%;
      }
      #rfc\.meta {
        width: 40%;
        float: right
      }
      .toc ul {
        list-style: none;
      }
      .filename {
        color: rgb(119, 119, 119);
        font-size: 23px;
        font-weight: normal;
        height: auto;
        line-height: 23px;
      }
      dl {
        margin-left: 1em;
      }
      dl.dl-horizontal: {
        margin-left: 0;
      }
      dl > dt {
        float: left;
        margin-right: 1em;
      }
      dl.nohang > dt {
        float: none;
      }
      dl > dd {
        margin-bottom: .5em;
      }
      dl.compact > dd {
        margin-bottom: 0em;
      }
      dl > dd > dl {
        margin-top: 0.5em;
        margin-bottom: 0em;
      }
      ul.empty {
        list-style-type: none;
      }
      ul.empty li {
        margin-top: .5em;
      }
      td.reference {
        padding-right: 1em;
        vertical-align: top;
      }
      .feedback {
        position: fixed;
        bottom: 5px;
        right: 5px;
      }
      .fbbutton {
        margin-left: 5px;
      }
      h1, h2, h3 {
        margin-top: 1.2em;
      }
      h1 a, h2 a, h3 a, h4 a, h5 a, h6 a {
        color: rgb(51, 51, 51);
      }
      span.tt {
        font: 11pt consolas, monospace;
        font-size-adjust: none;
      }
    </style><link rel="Contents" href="#rfc.toc"><link rel="Author" href="#rfc.authors"><link rel="License" href="#rfc.copyrightnotice"><link rel="Chapter" title="1 Introduction" href="#rfc.section.1"><link rel="Chapter" title="2 Security Considerations" href="#rfc.section.2"><link rel="Chapter" title="3 References" href="#rfc.section.3"><link rel="Appendix" title="A Data Supporting Field Compatibility" href="#rfc.section.A"><meta name="viewport" content="initial-scale=1"><meta name="generator" content="https://github.com/mnot/RFCBootstrap XSLT vendor: Saxonica http://www.saxonica.com/"><meta name="keywords" content="Internet-Draft"><link rel="schema.dcterms" href="http://purl.org/dc/terms/"><meta name="dcterms.creator" content="Nottingham, M."><meta name="dcterms.identifier" content="urn:ietf:id:draft-nottingham-http-structure-retrofit-00"><meta name="dcterms.issued" content="2021-10-07"><meta name="dcterms.abstract" content="This specification defines how a selection of existing HTTP fields can be handled as Structured Fields."><meta name="description" content="This specification defines how a selection of existing HTTP fields can be handled as Structured Fields."></head><body><script async="True" defer="True" src="https://hypothes.is/embed.js"></script><div class="container" id="top"><div class="row"><div class="col-lg-4 order-last d-none d-lg-block" id="sidebar" role="navigation"><div class="navbar"><div class="navbar-brand"><a href="#top"></a></div><br clear="all"><div class=""><div class="toc "><ul><li><a href="#rfc.section.1">1.</a>&nbsp;&nbsp;&nbsp;<a href="#introduction">Introduction</a><ul><li><a href="#rfc.section.1.1">1.1.</a>&nbsp;&nbsp;&nbsp;<a href="#notational-conventions">Notational Conventions</a></li><li><a href="#rfc.section.1.2">1.2.</a>&nbsp;&nbsp;&nbsp;<a href="#compatible">Compatible Fields</a></li><li><a href="#rfc.section.1.3">1.3.</a>&nbsp;&nbsp;&nbsp;<a href="#mapped">Mapped Fields</a><ul><li><a href="#rfc.section.1.3.1">1.3.1.</a>&nbsp;&nbsp;&nbsp;<a href="#urls">URLs</a></li><li><a href="#rfc.section.1.3.2">1.3.2.</a>&nbsp;&nbsp;&nbsp;<a href="#dates">Dates</a></li><li><a href="#rfc.section.1.3.3">1.3.3.</a>&nbsp;&nbsp;&nbsp;<a href="#etags">ETags</a></li><li><a href="#rfc.section.1.3.4">1.3.4.</a>&nbsp;&nbsp;&nbsp;<a href="#links">Links</a></li><li><a href="#rfc.section.1.3.5">1.3.5.</a>&nbsp;&nbsp;&nbsp;<a href="#cookies">Cookies</a></li></ul></li><li><a href="#rfc.section.1.4">1.4.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-considerations">IANA Considerations</a></li></ul></li><li><a href="#rfc.section.2">2.</a>&nbsp;&nbsp;&nbsp;<a href="#security-considerations">Security Considerations</a></li><li><a href="#rfc.section.3">3.</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references">Normative References</a></li><li><a href="#rfc.section.A">Appendix A.</a>&nbsp;&nbsp;&nbsp;<a href="#numbers">Data Supporting Field Compatibility</a></li><li><a href="#rfc.authors">Author's Address</a></li></ul></div></div></div></div><div class="col-lg-8 order-first main" role="main"><header><table class="table table-condensed header" id="rfc.headerblock"><tbody><tr><td class="text-left">Network Working Group</td><td class="text-right">M. Nottingham</td></tr><tr><td class="text-left">Internet-Draft</td><td class="text-right">October 7, 2021</td></tr><tr><td class="text-left">Intended status: Informational</td><td class="text-right"></td></tr><tr><td class="text-left">Expires: April 10, 2022</td><td class="text-right"></td></tr></tbody></table><div id="rfc.title"><h1>Retrofit Structured Fields for HTTP</h1><div class="filename"><a href="https://datatracker.ietf.org/doc/draft-nottingham-http-structure-retrofit" class="smpl">draft-nottingham-http-structure-retrofit</a>-<a href="https://tools.ietf.org/html/draft-nottingham-http-structure-retrofit-00" class="smpl">00</a></div></div></header><hr><h2 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h2><div class="lead"><div id="rfc.abstract.p.1"><p>This specification defines how a selection of existing HTTP fields can be handled as Structured Fields.</p></div></div><section id="rfc.note.1" class="note"><h2><a href="#rfc.note.1">Note to Readers</a></h2><div id="rfc.note.1.p.1"><p><em>RFC EDITOR: please remove this section before publication</em></p></div><div id="rfc.note.1.p.2"><p>The issues list for this draft can be found at <a href="https://github.com/mnot/I-D/labels/http-structure-retrofit">https://github.com/mnot/I-D/labels/http-structure-retrofit</a>.</p></div><div id="rfc.note.1.p.3"><p>The most recent (often, unpublished) draft is at <a href="https://mnot.github.io/I-D/http-structure-retrofit/">https://mnot.github.io/I-D/http-structure-retrofit/</a>.</p></div><div id="rfc.note.1.p.4"><p>Recent changes are listed at <a href="https://github.com/mnot/I-D/commits/gh-pages/http-structure-retrofit">https://github.com/mnot/I-D/commits/gh-pages/http-structure-retrofit</a>.</p></div><div id="rfc.note.1.p.5"><p>See also the draft's current status in the IETF datatracker, at <a href="https://datatracker.ietf.org/doc/draft-nottingham-http-structure-retrofit/">https://datatracker.ietf.org/doc/draft-nottingham-http-structure-retrofit/</a>.</p></div></section><section id="rfc.status"><h2><a href="#rfc.status">Status of this Memo</a></h2><div id="rfc.boilerplate.1.p.1"><p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p></div><div id="rfc.boilerplate.1.p.2"><p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF). Note that other groups may also distribute working documents as Internet-Drafts. The list of current Internet-Drafts is at <a href="http://datatracker.ietf.org/drafts/current/">http://datatracker.ietf.org/drafts/current/</a>.</p></div><div id="rfc.boilerplate.1.p.3"><p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time. It is inappropriate to use Internet-Drafts as reference material or to cite them other than as “work in progress”.</p></div><div id="rfc.boilerplate.1.p.4"><p>This Internet-Draft will expire on April 10, 2022.</p></div></section><section id="rfc.copyrightnotice"><h2><a href="#rfc.copyrightnotice">Copyright Notice</a></h2><div id="rfc.boilerplate.2.p.1"><p>Copyright © 2021 IETF Trust and the persons identified as the document authors. All rights reserved.</p></div><div id="rfc.boilerplate.2.p.2"><p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of publication of this document. Please review these documents carefully, as they describe your rights and restrictions with respect to this document. Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p></div></section><div class="toc d-lg-none"><ul><li><a href="#rfc.section.1">1.</a>&nbsp;&nbsp;&nbsp;<a href="#introduction">Introduction</a><ul><li><a href="#rfc.section.1.1">1.1.</a>&nbsp;&nbsp;&nbsp;<a href="#notational-conventions">Notational Conventions</a></li><li><a href="#rfc.section.1.2">1.2.</a>&nbsp;&nbsp;&nbsp;<a href="#compatible">Compatible Fields</a></li><li><a href="#rfc.section.1.3">1.3.</a>&nbsp;&nbsp;&nbsp;<a href="#mapped">Mapped Fields</a><ul><li><a href="#rfc.section.1.3.1">1.3.1.</a>&nbsp;&nbsp;&nbsp;<a href="#urls">URLs</a></li><li><a href="#rfc.section.1.3.2">1.3.2.</a>&nbsp;&nbsp;&nbsp;<a href="#dates">Dates</a></li><li><a href="#rfc.section.1.3.3">1.3.3.</a>&nbsp;&nbsp;&nbsp;<a href="#etags">ETags</a></li><li><a href="#rfc.section.1.3.4">1.3.4.</a>&nbsp;&nbsp;&nbsp;<a href="#links">Links</a></li><li><a href="#rfc.section.1.3.5">1.3.5.</a>&nbsp;&nbsp;&nbsp;<a href="#cookies">Cookies</a></li></ul></li><li><a href="#rfc.section.1.4">1.4.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-considerations">IANA Considerations</a></li></ul></li><li><a href="#rfc.section.2">2.</a>&nbsp;&nbsp;&nbsp;<a href="#security-considerations">Security Considerations</a></li><li><a href="#rfc.section.3">3.</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references">Normative References</a></li><li><a href="#rfc.section.A">Appendix A.</a>&nbsp;&nbsp;&nbsp;<a href="#numbers">Data Supporting Field Compatibility</a></li><li><a href="#rfc.authors">Author's Address</a></li></ul></div><section id="introduction"><h2 id="rfc.section.1" class="np"><a href="#rfc.section.1">1.</a>&nbsp;<a href="#introduction">Introduction</a></h2><div id="rfc.section.1.p.1" class="avoidbreakafter"><p>Structured Field Values for HTTP <a href="#STRUCTURED-FIELDS"><cite title="Structured Field Values for HTTP">[STRUCTURED-FIELDS]</cite></a> introduced a data model with associated parsing and serialisation algorithms for HTTP field values. Header fields that are defined as Structured Fields can realise a number of benefits, including:</p></div><div id="rfc.section.1.p.2"><ul><li>Improved interoperability and security: precisely defined parsing and serialisation algorithms are typically not available for fields defined with just ABNF and/or prose.</li><li>Reuse of common implementations: many parsers for other fields are specific to a single field or a small family of fields</li><li>Canonical form: because a deterministic serialisation algorithm is defined for each type, Structure Fields have a canonical representation</li><li>Enhanced API support: a regular data model makes it easier to expose field values as a native data structure in implementations</li><li>Alternative serialisations: While <a href="#STRUCTURED-FIELDS"><cite title="Structured Field Values for HTTP">[STRUCTURED-FIELDS]</cite></a> defines a textual serialisation of that data model, other, more efficient serialisations of the underlying data model are also possible.</li></ul></div><div id="rfc.section.1.p.3"><p>However, a field needs to be defined as a Structured Field for these benefits to be realised. Many existing fields are not, making up the bulk of header and trailer fields seen in HTTP traffic on the Internet.</p></div><div id="rfc.section.1.p.4"><p>This specification defines how a selection of existing HTTP fields can be handled as Structured Fields, so that these benefits can be realised -- thereby making them Retrofit Structured Fields.</p></div><div id="rfc.section.1.p.5"><p>It does so using two techniques. <a href="#compatible" title="Compatible Fields">Section&nbsp;1.2</a> lists compatible fields -- those that can be handled as if they were Structured Fields due to the similarity of their defined syntax to that in Structured Fields. <a href="#mapped" title="Mapped Fields">Section&nbsp;1.3</a> lists mapped fields -- those whose syntax needs to be transformed into an underlying data model which is then mapped into that defined by Structured Fields.</p></div><div id="rfc.section.1.p.6"><p>While implementations can parse and serialise Compatible Fields as Structured Fields subject to the caveats in <a href="#compatible" title="Compatible Fields">Section&nbsp;1.2</a>, a sender cannot generate mapped fields from <a href="#mapped" title="Mapped Fields">Section&nbsp;1.3</a> and expect them to be understood and acted upon by the recipient without prior negotiation. This specification does not define such a mechanism.</p></div><section id="notational-conventions"><h3 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a>&nbsp;<a href="#notational-conventions">Notational Conventions</a></h3><div id="rfc.section.1.1.p.1"><p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <a href="#RFC2119"><cite title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</cite></a> <a href="#RFC8174"><cite title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">[RFC8174]</cite></a> when, and only when, they appear in all capitals, as shown here.</p></div></section><section id="compatible"><h3 id="rfc.section.1.2"><a href="#rfc.section.1.2">1.2.</a>&nbsp;<a href="#compatible">Compatible Fields</a></h3><div id="rfc.section.1.2.p.1"><p>HTTP fields with the following names can usually have their values handled as Structured Fields according to the listed parsing and serialisation algorithms in <a href="#RFC8941"><cite title="Structured Field Values for HTTP">[RFC8941]</cite></a>, subject to the listed caveats.</p></div><div id="rfc.section.1.2.p.2"><p>The listed types are chosen for compatibility with the defined syntax of the field as well as with actual Internet traffic (see <a href="#numbers" title="Data Supporting Field Compatibility">Appendix&nbsp;A</a>). However, not all instances of these fields will successfully parse. This might be because the field value is clearly invalid, or it might be because it is valid but not parseable as a Structured Field.</p></div><div id="rfc.section.1.2.p.3"><p>As such, an application using this specification will need to consider how to handle these field values. Depending on its requirements, it might be advisable to reject such values, treat them as opaque strings, or attempt to recover a structured value from them in an ad hoc fashion.</p></div><div id="rfc.section.1.2.p.4"><ul><li>Accept - List</li><li>Accept-Encoding - List</li><li>Accept-Language - List</li><li>Accept-Patch - List</li><li>Accept-Ranges - List</li><li>Access-Control-Allow-Credentials - Item</li><li>Access-Control-Allow-Headers - List</li><li>Access-Control-Allow-Methods - List</li><li>Access-Control-Allow-Origin - Item</li><li>Access-Control-Expose-Headers - List</li><li>Access-Control-Max-Age - Item</li><li>Access-Control-Request-Headers - List</li><li>Access-Control-Request-Method - Item</li><li>Age - Item</li><li>Allow - List</li><li>ALPN - List</li><li>Alt-Svc - Dictionary</li><li>Alt-Used - Item</li><li>Cache-Control - Dictionary</li><li>Connection - List</li><li>Content-Encoding - List</li><li>Content-Language - List</li><li>Content-Length - List</li><li>Content-Type - Item</li><li>Cross-Origin-Resource-Policy - Item</li><li>Expect - Item</li><li>Expect-CT - Dictionary</li><li>Host - Item</li><li>Keep-Alive - Dictionary</li><li>Origin - Item</li><li>Pragma - Dictionary</li><li>Prefer - Dictionary</li><li>Preference-Applied - Dictionary</li><li>Retry-After - Item</li><li>Surrogate-Control - Dictionary</li><li>TE - List</li><li>Timing-Allow-Origin: List</li><li>Trailer - List</li><li>Transfer-Encoding - List</li><li>Vary - List</li><li>X-Content-Type-Options - Item</li><li>X-Frame-Options - Item</li><li>X-XSS-Protection - List</li></ul></div><div id="rfc.section.1.2.p.5" class="avoidbreakafter"><p>Note the following caveats:</p></div><div id="rfc.section.1.2.p.6"><dl><dt>Parameters:</dt><dd><p>HTTP parameter names are case-insensitive (as per Section 5.6.6 of <a href="#HTTP"><cite title="HTTP Semantics">[HTTP]</cite></a>), but Structured Fields require them to be all-lowercase. Although the vast majority of parameters seen in typical traffic are all-lowercase, compatibility can be improved by force-lowercasing parameters when encountered.</p></dd><dt>Empty Field Values:</dt><dd><p>Empty and whitespace-only field values are considered errors in Structured Fields. For compatible fields, an empty field indicates that the field should be silently ignored.</p></dd><dt>Alt-Svc:</dt><dd><p>Some ALPN tokens (e.g., <span class="tt">h3-Q43</span>) do not conform to key's syntax. Since the final version of HTTP/3 uses the <span class="tt">h3</span> token, this shouldn't be a long-term issue, although future tokens may again violate this assumption.</p></dd><dt>Cache-Control, Expect-CT, Pragma, Prefer, Preference-Applied, Surrogate-Control:</dt><dd><p>These Dictionary-based fields consider the key to be case-insensitive, but Structured Fields requires keys to be all-lowercase. Although the vast majority of values seen in typical traffic are all-lowercase, compatibility can be improved by force-lowercasing these Dictionary keys when encountered.</p></dd><dt>Content-Length:</dt><dd><p>Content-Length is defined as a List because it is not uncommon for implementations to mistakenly send multiple values. See Section 8.6 of <a href="#HTTP"><cite title="HTTP Semantics">[HTTP]</cite></a> for handling requirements.</p></dd><dt>Retry-After:</dt><dd><p>Only the delta-seconds form of Retry-After is supported; a Retry-After value containing a http-date will need to be either converted into delta-seconds or represented as a raw value.</p></dd></dl></div></section><section id="mapped"><h3 id="rfc.section.1.3"><a href="#rfc.section.1.3">1.3.</a>&nbsp;<a href="#mapped">Mapped Fields</a></h3><div id="rfc.section.1.3.p.1"><p>HTTP fields with the following names can have their values represented in Structured Fields by mapping them into its data types and then serialising the result using an alternative field name.</p></div><div id="rfc.section.1.3.p.2" class="avoidbreakafter"><p>For example, the Date HTTP header field carries a string representing a date:</p></div><div id="rfc.section.1.3.p.3"><pre>
Date: Sun, 06 Nov 1994 08:49:37 GMT
</pre></div><div id="rfc.section.1.3.p.4" class="avoidbreakafter"><p>Its value is more efficiently represented as an integer number of delta seconds from the Unix epoch (00:00:00 UTC on 1 January 1970, minus leap seconds). Thus, the example above would be mapped as:</p></div><div id="rfc.section.1.3.p.5"><pre>
SF-Date: 784072177
</pre></div><div id="rfc.section.1.3.p.6"><p>As in <a href="#compatible" title="Compatible Fields">Section&nbsp;1.2</a>, these fields are unable to represent values that are not Structured Fields, and so an application using this specification will need to how to support such values. Typically, serialising them using the original field name is sufficient.</p></div><div id="rfc.section.1.3.p.7"><p>Each field name listed below indicates a replacement field name and a means of mapping its original value into a Structured Field.</p></div><section id="urls"><h4 id="rfc.section.1.3.1"><a href="#rfc.section.1.3.1">1.3.1.</a>&nbsp;<a href="#urls">URLs</a></h4><div id="rfc.section.1.3.1.p.1"><p>The following field names (paired with their replacement field names) have values that can be represented as Structured Fields by considering the original field's value as a string.</p></div><div id="rfc.section.1.3.1.p.2"><ul><li>Content-Location - SF-Content-Location</li><li>Location - SF-Location</li><li>Referer - SF-Referer</li></ul></div><div id="rfc.section.1.3.1.p.3" class="avoidbreakafter"><p>For example, a Location field could be represented as:</p></div><div id="rfc.section.1.3.1.p.4"><pre>
SF-Location: "https://example.com/foo"
</pre></div></section><section id="dates"><h4 id="rfc.section.1.3.2"><a href="#rfc.section.1.3.2">1.3.2.</a>&nbsp;<a href="#dates">Dates</a></h4><div id="rfc.section.1.3.2.p.1"><p>The following field names (paired with their replacement field names) have values that can be represented as Structured Fields by parsing their payload according to <a href="#RFC7231"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content">[RFC7231]</cite></a>, Section 7.1.1.1, and representing the result as an integer number of seconds delta from the Unix Epoch (00:00:00 UTC on 1 January 1970, minus leap seconds).</p></div><div id="rfc.section.1.3.2.p.2"><ul><li>Date - SF-Date</li><li>Expires - SF-Expires</li><li>If-Modified-Since - SF-IMS</li><li>If-Unmodified-Since - SF-IUS</li><li>Last-Modified - SF-LM</li></ul></div><div id="rfc.section.1.3.2.p.3" class="avoidbreakafter"><p>For example, an Expires field could be represented as:</p></div><div id="rfc.section.1.3.2.p.4"><pre>
SF-Expires: 1571965240
</pre></div></section><section id="etags"><h4 id="rfc.section.1.3.3"><a href="#rfc.section.1.3.3">1.3.3.</a>&nbsp;<a href="#etags">ETags</a></h4><div id="rfc.section.1.3.3.p.1"><p>The following field names (paired with their replacement field names) have values that can be represented as Structured Fields by representing the entity-tag as a string, and the weakness flag as a boolean "w" parameter on it, where true indicates that the entity-tag is weak; if 0 or unset, the entity-tag is strong.</p></div><div id="rfc.section.1.3.3.p.2"><ul><li>ETag - SF-ETag</li></ul></div><div id="rfc.section.1.3.3.p.3" class="avoidbreakafter"><p>For example:</p></div><div id="rfc.section.1.3.3.p.4"><pre>
SF-ETag: "abcdef"; w=?1
</pre></div><div id="rfc.section.1.3.3.p.5"><p>If-None-Match is a list of the structure described above.</p></div><div id="rfc.section.1.3.3.p.6"><ul><li>If-None-Match - SF-INM</li></ul></div><div id="rfc.section.1.3.3.p.7" class="avoidbreakafter"><p>For example:</p></div><div id="rfc.section.1.3.3.p.8"><pre>
SF-INM: "abcdef"; w=?1, "ghijkl"
</pre></div></section><section id="links"><h4 id="rfc.section.1.3.4"><a href="#rfc.section.1.3.4">1.3.4.</a>&nbsp;<a href="#links">Links</a></h4><div id="rfc.section.1.3.4.p.1"><p>The field-value of the Link header field <a href="#RFC8288"><cite title="Web Linking">[RFC8288]</cite></a> can be represented as a Structured Field by representing the URI-Reference as a string, and link-param as parameters.</p></div><div id="rfc.section.1.3.4.p.2"><ul><li>Link: SF-Link</li></ul></div><div id="rfc.section.1.3.4.p.3" class="avoidbreakafter"><p>For example:</p></div><div id="rfc.section.1.3.4.p.4"><pre>
SF-Link: "/terms"; rel="copyright"; anchor="#foo"
</pre></div></section><section id="cookies"><h4 id="rfc.section.1.3.5"><a href="#rfc.section.1.3.5">1.3.5.</a>&nbsp;<a href="#cookies">Cookies</a></h4><div id="rfc.section.1.3.5.p.1"><p>The field-values of the Cookie and Set-Cookie fields <a href="#RFC6265"><cite title="HTTP State Management Mechanism">[RFC6265]</cite></a> can be represented in Structured Fields as a List with parameters and a Dictionary, respectively.</p></div><div id="rfc.section.1.3.5.p.2"><p>The serialisation is almost identical, except that the Expires parameter is always a string (as it can contain a comma), multiple cookie-strings can appear in Set-Cookie, and cookie-pairs are delimited in Cookie by a comma, rather than a semicolon.</p></div><div id="rfc.section.1.3.5.p.3"><ul><li>Set-Cookie: SF-Set-Cookie</li><li>Cookie: SF-Cookie</li></ul></div><div id="rfc.section.1.3.5.p.4"><pre>
SF-Set-Cookie: lang=en-US; expires="Wed, 09 Jun 2021 10:18:14 GMT";
               samesite=Strict
SF-Cookie: SID=31d4d96e407aad42, lang=en-US
</pre></div><div id="rfc.section.1.3.5.p.5"><ul><li>ISSUE: explicitly convert Expires to an integer? <a href="https://github.com/mnot/I-D/issues/308">https://github.com/mnot/I-D/issues/308</a></li><li>ISSUE: dictionary keys cannot contain UC alpha. <a href="https://github.com/mnot/I-D/issues/312">https://github.com/mnot/I-D/issues/312</a></li><li>ISSUE: explicitly allow non-string content. <a href="https://github.com/mnot/I-D/issues/313">https://github.com/mnot/I-D/issues/313</a></li></ul></div></section></section><section id="iana-considerations"><h3 id="rfc.section.1.4"><a href="#rfc.section.1.4">1.4.</a>&nbsp;<a href="#iana-considerations">IANA Considerations</a></h3><div id="rfc.section.1.4.p.1" class="avoidbreakafter"><p>IANA is asked to register the following entries in the HTTP Field Name Registry with a status of "permanent" and referring to this document:</p></div><div id="rfc.section.1.4.p.2"><ul><li>SF-Content-Location</li><li>SF-Location</li><li>SF-Referer</li><li>SF-Date</li><li>SF-Expires</li><li>SF-IMS</li><li>SF-IUS</li><li>SF-LM</li><li>SF-ETag</li><li>SF-INM</li><li>SF-Link</li><li>SF-Set-Cookie</li><li>SF-Cookie</li></ul></div></section></section><section id="security-considerations"><h2 id="rfc.section.2"><a href="#rfc.section.2">2.</a>&nbsp;<a href="#security-considerations">Security Considerations</a></h2><div id="rfc.section.2.p.1"><p><a href="#compatible" title="Compatible Fields">Section&nbsp;1.2</a> identifies existing HTTP fields that can be parsed and serialised with the algorithms defined in <a href="#STRUCTURED-FIELDS"><cite title="Structured Field Values for HTTP">[STRUCTURED-FIELDS]</cite></a>. Variances from other implementations might be exploitable, particularly if they allow an attacker to target one implementation in a chain (e.g., an intermediary). However, given the considerable variance in parsers already deployed, convergence towards a single parsing algorithm is likely to have a net security benefit in the longer term.</p></div><div id="rfc.section.2.p.2"><p><a href="#mapped" title="Mapped Fields">Section&nbsp;1.3</a> defines alternative representations of existing fields. Because downstream consumers might interpret the message differently based upon whether they recognise the alternative representation, implementations are prohibited from generating such fields unless they have negotiated support for them with their peer. This specification does not define such a mechanism, but any such definition needs to consider the implications of doing so carefully.</p></div></section><section><div id="rfc.references"><h2 id="rfc.section.3"><a href="#rfc.section.3">3.</a> Normative References</h2><dl class="dl-horizontal"><dt id="HTTP">[HTTP]</dt><dd>Fielding, R., Nottingham, M., and J. , “<a href="https://www.ietf.org/archive/id/draft-ietf-httpbis-semantics-19.txt">HTTP Semantics</a>”, Internet-Draft&nbsp;draft-ietf-httpbis-semantics-19 (<a href="https://datatracker.ietf.org/doc/draft-ietf-httpbis-semantics">work in progress</a>), September&nbsp;2021, &lt;<a href="https://www.ietf.org/archive/id/draft-ietf-httpbis-semantics-19.txt">https://www.ietf.org/archive/id/draft-ietf-httpbis-semantics-19.txt</a>&gt;.</dd><dt id="RFC2119">[RFC2119]</dt><dd>Bradner, S., “<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>”, BCP&nbsp;14, RFC&nbsp;2119, <a href="http://dx.doi.org/10.17487/RFC2119">DOI&nbsp;10.17487/RFC2119</a>, March&nbsp;1997, &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.</dd><dt id="RFC6265">[RFC6265]</dt><dd>Barth, A., “<a href="https://tools.ietf.org/html/rfc6265">HTTP State Management Mechanism</a>”, RFC&nbsp;6265, <a href="http://dx.doi.org/10.17487/RFC6265">DOI&nbsp;10.17487/RFC6265</a>, April&nbsp;2011, &lt;<a href="https://www.rfc-editor.org/info/rfc6265">https://www.rfc-editor.org/info/rfc6265</a>&gt;.</dd><dt id="RFC7231">[RFC7231]</dt><dd>Fielding, R., Ed. and J. Reschke, Ed., “<a href="https://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>”, RFC&nbsp;7231, <a href="http://dx.doi.org/10.17487/RFC7231">DOI&nbsp;10.17487/RFC7231</a>, June&nbsp;2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7231">https://www.rfc-editor.org/info/rfc7231</a>&gt;.</dd><dt id="RFC8174">[RFC8174]</dt><dd>Leiba, B., “<a href="https://tools.ietf.org/html/rfc8174">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>”, BCP&nbsp;14, RFC&nbsp;8174, <a href="http://dx.doi.org/10.17487/RFC8174">DOI&nbsp;10.17487/RFC8174</a>, May&nbsp;2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.</dd><dt id="RFC8288">[RFC8288]</dt><dd>Nottingham, M., “<a href="https://tools.ietf.org/html/rfc8288">Web Linking</a>”, RFC&nbsp;8288, <a href="http://dx.doi.org/10.17487/RFC8288">DOI&nbsp;10.17487/RFC8288</a>, October&nbsp;2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8288">https://www.rfc-editor.org/info/rfc8288</a>&gt;.</dd><dt id="RFC8941">[RFC8941]</dt><dd>Nottingham, M. and P-H. Kamp, “<a href="https://tools.ietf.org/html/rfc8941">Structured Field Values for HTTP</a>”, RFC&nbsp;8941, <a href="http://dx.doi.org/10.17487/RFC8941">DOI&nbsp;10.17487/RFC8941</a>, February&nbsp;2021, &lt;<a href="https://www.rfc-editor.org/info/rfc8941">https://www.rfc-editor.org/info/rfc8941</a>&gt;.</dd><dt id="STRUCTURED-FIELDS">[STRUCTURED-FIELDS]</dt><dd>Nottingham, M. and P-H. Kamp, “<a href="https://tools.ietf.org/html/rfc8941">Structured Field Values for HTTP</a>”, RFC&nbsp;8941, <a href="http://dx.doi.org/10.17487/RFC8941">DOI&nbsp;10.17487/RFC8941</a>, February&nbsp;2021, &lt;<a href="https://www.rfc-editor.org/info/rfc8941">https://www.rfc-editor.org/info/rfc8941</a>&gt;.</dd></dl></div></section><section id="numbers"><h2 id="rfc.section.A" class="np"><a href="#rfc.section.A">Appendix A.</a>&nbsp;<a href="#numbers">Data Supporting Field Compatibility</a></h2><div id="rfc.section.A.p.1" class="avoidbreakafter"><p>To help guide decisions about compatible fields, the HTTP response headers captured by the HTTP Archive <a href="https://httparchive.org">https://httparchive.org</a> in September 2021 (representing more than 528,000,000 HTTP exchanges) were parsed as Structured Fields using the types listed in <a href="#compatible" title="Compatible Fields">Section&nbsp;1.2</a>, with the indicated number of successful header instances, failures, and the resulting failure rate:</p></div><div id="rfc.section.A.p.2"><pre>
accept                                 9,099 /        34 =   0.372%*
accept-encoding                      116,708 /        58 =   0.050%*
accept-language                      127,710 /        95 =   0.074%*
accept-patch                             281 /         0 =   0.000%
accept-ranges                    289,341,375 /     7,776 =   0.003%
access-control-allow-credentials  36,159,371 /     2,671 =   0.007%
access-control-allow-headers      25,980,519 /    23,181 =   0.089%
access-control-allow-methods      32,071,437 /    17,424 =   0.054%
access-control-allow-origin      165,719,859 /   130,247 =   0.079%
access-control-expose-headers     20,787,683 /     1,973 =   0.009%
access-control-max-age             9,549,494 /     9,846 =   0.103%
access-control-request-headers       165,882 /       503 =   0.302%*
access-control-request-method        346,135 /    30,680 =   8.142%*
age                              107,395,872 /    36,649 =   0.034%
allow                                579,822 /       281 =   0.048%
alt-svc                           56,773,977 / 4,914,119 =   7.966%
cache-control                    395,402,834 / 1,146,080 =   0.289%
connection                       112,017,641 /     3,491 =   0.003%
content-encoding                 225,568,224 /       237 =   0.000%
content-language                   3,339,291 /     1,744 =   0.052%
content-length                   422,415,406 /       126 =   0.000%
content-type                     503,950,894 /   507,133 =   0.101%
cross-origin-resource-policy     102,483,430 /       799 =   0.001%
expect                                     0 /        53 = 100.000%*
expect-ct                         54,129,244 /    80,333 =   0.148%
host                                  57,134 /     1,486 =   2.535%*
keep-alive                        50,606,877 /     1,509 =   0.003%
origin                                32,438 /     1,396 =   4.126%*
pragma                            66,321,848 /    97,328 =   0.147%
preference-applied                       189 /         0 =   0.000%
referrer-policy                   14,274,787 /     8,091 =   0.057%
retry-after                          523,533 /     7,585 =   1.428%
surrogate-control                    282,846 /       976 =   0.344%
te                                         1 /         0 =   0.000%
timing-allow-origin               91,979,983 /         8 =   0.000%
trailer                                1,171 /         0 =   0.000%
transfer-encoding                 15,098,518 /         0 =   0.000%
vary                             246,483,644 /    69,607 =   0.028%
x-content-type-options           166,063,072 /   237,255 =   0.143%
x-frame-options                   56,863,322 / 1,014,464 =   1.753%
x-xss-protection                 132,739,109 /   347,133 =   0.261%
</pre></div><div id="rfc.section.A.p.3"><p>Note that this data set only includes response headers, although some request headers are present, indicated with an asterisk (because, the Web). Also, Dictionary and Parameter keys have not been force-lowercased, with the result that any values containing uppercase keys are considered to fail.</p></div><div id="rfc.section.A.p.4" class="avoidbreakafter"><p>The top thirty header fields in that data set that were not considered compatible are (* indicates that the field is mapped in <a href="#mapped" title="Mapped Fields">Section&nbsp;1.3</a>):</p></div><div id="rfc.section.A.p.5"><ul><li>*date: 524,810,577</li><li>server: 470,777,294</li><li>*last-modified: 383,437,099</li><li>*expires: 292,109,781</li><li>*etag: 255,788,799</li><li>strict-transport-security: 111,993,787</li><li>x-cache: 70,713,258</li><li>via: 55,983,914</li><li>cf-ray: 54,556,881</li><li>p3p: 54,479,183</li><li>report-to: 54,056,804</li><li>cf-cache-status: 53,536,789</li><li>nel: 44,815,769</li><li>x-powered-by: 37,281,354</li><li>content-security-policy-report-only: 33,104,387</li><li>*location: 30,533,957</li><li>x-amz-cf-pop: 28,549,182</li><li>x-amz-cf-id: 28,444,359</li><li>content-security-policy: 25,404,401</li><li>x-served-by: 23,277,252</li><li>x-cache-hits: 21,842,899</li><li>*link: 20,761,372</li><li>x-timer: 18,780,130</li><li>content-disposition: 18,516,671</li><li>x-request-id: 16,048,668</li><li>referrer-policy: 15,596,734</li><li>x-cdn: 10,153,756</li><li>x-amz-version-id: 9,786,024</li><li>x-amz-request-id: 9,680,689</li><li>x-dc: 9,557,728</li></ul></div></section><section id="rfc.authors" class="avoidbreakinside"><h2><a href="#rfc.authors">Author's Address</a></h2><address><b>Mark Nottingham</b><br>Prahran<br>VIC<br>Australia<br>EMail: <a href="mailto:mnot@mnot.net">mnot@mnot.net</a><br>URI: <a href="https://www.mnot.net/">https://www.mnot.net/</a></address></section></div></div></div><script src="../Tools/node_modules/jquery/dist/jquery.min.js"></script><script src="../Tools/node_modules/bootstrap/dist/js/bootstrap.min.js"></script></body></html>